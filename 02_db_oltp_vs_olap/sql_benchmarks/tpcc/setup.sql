DROP TABLE IF EXISTS ORDER_LINE;
DROP TABLE IF EXISTS NEW_ORDER;
DROP TABLE IF EXISTS ORDERS;
DROP TABLE IF EXISTS STOCK;
DROP TABLE IF EXISTS HISTORY;
DROP TABLE IF EXISTS CUSTOMER;
DROP TABLE IF EXISTS ITEM;
DROP TABLE IF EXISTS DISTRICT;
DROP TABLE IF EXISTS WAREHOUSE;

-- WAREHOUSE
CREATE TABLE WAREHOUSE (
  W_ID     SMALLINT    NOT NULL DEFAULT 0,
  W_NAME   VARCHAR(16),
  W_STREET_1 VARCHAR(32),
  W_STREET_2 VARCHAR(32),
  W_CITY   VARCHAR(32),
  W_STATE  VARCHAR(2),
  W_ZIP    VARCHAR(9),
  W_TAX    FLOAT,
  W_YTD    FLOAT,
  PRIMARY KEY (W_ID)
);

-- DISTRICT
CREATE TABLE DISTRICT (
  D_ID     TINYINT     NOT NULL DEFAULT 0,
  D_W_ID   SMALLINT    NOT NULL DEFAULT 0  REFERENCES WAREHOUSE(W_ID),
  D_NAME   VARCHAR(16),
  D_STREET_1 VARCHAR(32),
  D_STREET_2 VARCHAR(32),
  D_CITY   VARCHAR(32),
  D_STATE  VARCHAR(2),
  D_ZIP    VARCHAR(9),
  D_TAX    FLOAT,
  D_YTD    FLOAT,
  D_NEXT_O_ID INT,
  PRIMARY KEY (D_ID, D_W_ID)
);

-- ITEM
CREATE TABLE ITEM (
  I_ID     INTEGER     NOT NULL DEFAULT 0,
  I_IM_ID  INTEGER,
  I_NAME   VARCHAR(32),
  I_PRICE  FLOAT,
  I_DATA   VARCHAR(64),
  PRIMARY KEY (I_ID)
);

-- CUSTOMER
CREATE TABLE CUSTOMER (
  C_ID       INTEGER     NOT NULL DEFAULT 0,
  C_D_ID     TINYINT     NOT NULL DEFAULT 0,
  C_W_ID     SMALLINT    NOT NULL DEFAULT 0,
  C_FIRST    VARCHAR(32),
  C_MIDDLE   VARCHAR(2),
  C_LAST     VARCHAR(32),
  C_STREET_1 VARCHAR(32),
  C_STREET_2 VARCHAR(32),
  C_CITY     VARCHAR(32),
  C_STATE    VARCHAR(2),
  C_ZIP      VARCHAR(9),
  C_PHONE    VARCHAR(32),
  C_SINCE    TIMESTAMP   NOT NULL DEFAULT CURRENT_TIMESTAMP,
  C_CREDIT   VARCHAR(2),
  C_CREDIT_LIM FLOAT,
  C_DISCOUNT FLOAT,
  C_BALANCE  FLOAT,
  C_YTD_PAYMENT FLOAT,
  C_PAYMENT_CNT INTEGER,
  C_DELIVERY_CNT INTEGER,
  C_DATA     VARCHAR(500),
  PRIMARY KEY (C_W_ID, C_D_ID, C_ID),
  UNIQUE (C_ID, C_D_ID, C_W_ID),
  UNIQUE (C_W_ID, C_D_ID, C_LAST, C_FIRST),
  FOREIGN KEY (C_D_ID, C_W_ID) REFERENCES DISTRICT(D_ID, D_W_ID)
);
CREATE INDEX IDX_CUSTOMER ON CUSTOMER (C_W_ID, C_D_ID, C_LAST);

-- HISTORY
CREATE TABLE HISTORY (
  H_C_ID   INTEGER,
  H_C_D_ID TINYINT,
  H_C_W_ID SMALLINT,
  H_D_ID   TINYINT,
  H_W_ID   SMALLINT   NOT NULL DEFAULT 0,
  H_DATE   TIMESTAMP  NOT NULL DEFAULT CURRENT_TIMESTAMP,
  H_AMOUNT FLOAT,
  H_DATA   VARCHAR(32),
  FOREIGN KEY (H_C_ID, H_C_D_ID, H_C_W_ID) REFERENCES CUSTOMER(C_ID, C_D_ID, C_W_ID),
  FOREIGN KEY (H_D_ID, H_W_ID)           REFERENCES DISTRICT(D_ID, D_W_ID)
);

-- STOCK
CREATE TABLE STOCK (
  S_I_ID       INTEGER   NOT NULL DEFAULT 0 REFERENCES ITEM(I_ID),
  S_W_ID       SMALLINT  NOT NULL DEFAULT 0 REFERENCES WAREHOUSE(W_ID),
  S_QUANTITY   INTEGER   NOT NULL DEFAULT 0,
  S_DIST_01    VARCHAR(32),
  S_DIST_02    VARCHAR(32),
  S_DIST_03    VARCHAR(32),
  S_DIST_04    VARCHAR(32),
  S_DIST_05    VARCHAR(32),
  S_DIST_06    VARCHAR(32),
  S_DIST_07    VARCHAR(32),
  S_DIST_08    VARCHAR(32),
  S_DIST_09    VARCHAR(32),
  S_DIST_10    VARCHAR(32),
  S_YTD        INTEGER,
  S_ORDER_CNT  INTEGER,
  S_REMOTE_CNT INTEGER,
  S_DATA       VARCHAR(64),
  PRIMARY KEY (S_W_ID, S_I_ID),
  UNIQUE (S_I_ID, S_W_ID)
);

-- ORDERS
CREATE TABLE ORDERS (
  O_ID        INTEGER     NOT NULL DEFAULT 0,
  O_C_ID      INTEGER,
  O_D_ID      TINYINT     NOT NULL DEFAULT 0,
  O_W_ID      SMALLINT    NOT NULL DEFAULT 0,
  O_ENTRY_D   TIMESTAMP   NOT NULL DEFAULT CURRENT_TIMESTAMP,
  O_CARRIER_ID INTEGER,
  O_OL_CNT    INTEGER,
  O_ALL_LOCAL INTEGER,
  PRIMARY KEY (O_W_ID, O_D_ID, O_ID),
  UNIQUE (O_ID, O_D_ID, O_W_ID),
  UNIQUE (O_W_ID, O_D_ID, O_C_ID, O_ID),
  FOREIGN KEY (O_C_ID, O_D_ID, O_W_ID) REFERENCES CUSTOMER(C_ID, C_D_ID, C_W_ID)
);
CREATE INDEX IDX_ORDERS ON ORDERS (O_W_ID, O_D_ID, O_C_ID);

-- NEW_ORDER
CREATE TABLE NEW_ORDER (
  NO_O_ID INTEGER   NOT NULL DEFAULT 0,
  NO_D_ID TINYINT   NOT NULL DEFAULT 0,
  NO_W_ID SMALLINT  NOT NULL DEFAULT 0,
  PRIMARY KEY (NO_W_ID, NO_D_ID, NO_O_ID),
  FOREIGN KEY (NO_O_ID, NO_D_ID, NO_W_ID) REFERENCES ORDERS(O_ID, O_D_ID, O_W_ID)
);

-- ORDER_LINE
CREATE TABLE ORDER_LINE (
  OL_O_ID      INTEGER   NOT NULL DEFAULT 0,
  OL_D_ID      TINYINT   NOT NULL DEFAULT 0,
  OL_W_ID      SMALLINT  NOT NULL DEFAULT 0,
  OL_NUMBER    INTEGER   NOT NULL DEFAULT 0,
  OL_I_ID      INTEGER,
  OL_SUPPLY_W_ID SMALLINT,
  OL_DELIVERY_D TIMESTAMP,
  OL_QUANTITY  INTEGER,
  OL_AMOUNT    FLOAT,
  OL_DIST_INFO VARCHAR(32),
  PRIMARY KEY (OL_W_ID, OL_D_ID, OL_O_ID, OL_NUMBER),
  FOREIGN KEY (OL_O_ID, OL_D_ID, OL_W_ID) REFERENCES ORDERS(O_ID, O_D_ID, O_W_ID),
  FOREIGN KEY (OL_I_ID, OL_SUPPLY_W_ID)   REFERENCES STOCK(S_I_ID, S_W_ID)
);
CREATE INDEX IDX_ORDER_LINE_TREE ON ORDER_LINE (OL_W_ID, OL_D_ID, OL_O_ID);
